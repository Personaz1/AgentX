# План двухуровневой архитектуры NeuroRAT (C1 + Зонды)

## 1. Архитектурные изменения

### 1.1 Серверный агент C1 (NeuroNet)
- Разработать центральный модуль управления ботнетом (`botnet_controller.py`)
- Реализовать панель управления зондами в UI
- Интегрировать MCP-tools для управления файлами и системой
- Добавить систему мониторинга состояния всех зондов

### 1.2 Агент-зонд (NeuroZond)
- Создать облегченную версию агента (`neurozond.py`)
- Реализовать шифрованный канал связи с C1
- Разработать модуль скрытого выполнения команд
- Добавить механизмы маскировки активности

### 1.3 Коммуникационный протокол
- Разработать зашифрованный протокол для связи C1 с зондами
- Реализовать механизм проверки подлинности зондов
- Создать систему очередей задач для зондов

## 2. Функциональные изменения

### 2.1 Серверный агент C1
- **Расширенные возможности:**
  - Полный доступ к LLM для принятия решений
  - Управление всеми зондами через единый интерфейс
  - Распределение задач и анализ результатов
  - Хранение и анализ данных со всех зондов
  - Автономное принятие решений на основе собранных данных
  - Доступ к своему коду и возможность самомодификации
  - Интеграция с MCP-tools для управления файлами и выполнения команд

### 2.2 Агент-зонд
- **Ограниченные возможности:**
  - Выполнение команд, полученных от C1
  - Сканирование систем и сбор данных
  - Доступ к терминалу для выполнения команд
  - Скрытая работа без автономных решений
  - Обратная связь с C1 для передачи результатов
  - Минимальное использование ресурсов

## 3. Изменения в коде

### 3.1 Создание новых модулей
- `botnet_controller.py` - управление ботнетом зондов
- `neurozond.py` - основной модуль для зондов
- `zond_protocol.py` - протокол связи между C1 и зондами
- `task_manager.py` - система распределения задач

### 3.2 Модификация существующих файлов
- `server_api.py` - добавление эндпоинтов для управления зондами
- `agent_thinker.py` - адаптация для работы в двух режимах
- `neurorat_agent.py` - добавление поддержки зондов
- `environment_manager.py` - расширение для поддержки удаленного выполнения

### 3.3 Обновление интерфейса
- Добавление панели управления зондами
- Интеграция карты сети с отображением всех зондов
- Реализация интерфейса для постановки задач зондам

## 4. План реализации

### Этап 1: Базовая инфраструктура (7 дней)
1. Разработка протокола связи C1 с зондами
2. Создание скелета botnet_controller.py
3. Первичная версия neurozond.py
4. Базовая система аутентификации

### Этап 2: Функциональность C1 (5 дней)
1. Реализация управления зондами
2. Интеграция с MCP-tools
3. Расширение автономного режима для управления ботнетом
4. Хранение и анализ данных от зондов

### Этап 3: Функциональность зондов (5 дней)
1. Система скрытого выполнения команд
2. Механизмы сканирования и сбора данных
3. Модули для работы с терминалом
4. Система отчетности о выполненных задачах

### Этап 4: UI и интеграция (3 дня)
1. Обновление интерфейса для управления зондами
2. Создание визуализации сети зондов
3. Интеграция системы задач с UI

### Этап 5: Тестирование и оптимизация (5 дней)
1. Тестирование надежности коммуникаций
2. Оптимизация производительности
3. Усиление защиты коммуникаций
4. Проверка скрытности зондов

## 5. Детали реализации

### 5.1 Коммуникационный протокол
```python
# Примерная структура протокола
class ZondMessage:
    def __init__(self, type, data, signature):
        self.type = type  # command, result, heartbeat
        self.data = data  # payload
        self.signature = signature  # authentication
```

### 5.2 Система задач
```python
# Структура задачи для зонда
class ZondTask:
    def __init__(self, task_id, command, priority, timeout):
        self.task_id = task_id
        self.command = command
        self.priority = priority
        self.timeout = timeout
        self.status = "pending"
```

### 5.3 Жизненный цикл зонда
1. Инициализация и подключение к C1
2. Получение и выполнение команд
3. Отправка результатов
4. Ожидание следующей команды
5. Периодическая отправка heartbeat

## 6. Метрики успеха
- Успешное управление минимум 10 зондами одновременно
- Время отклика зонда < 2 секунды
- Расход памяти зонда < 100MB
- Скрытность работы зонда (не обнаруживается базовыми средствами защиты)
- Надежность связи > 99% 