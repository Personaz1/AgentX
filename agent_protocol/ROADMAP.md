# План разработки системы агентской коммуникации

## Этап 1: Базовая инфраструктура ✅
- Проектирование протокола обмена сообщениями ✅
- Разработка системы шифрования (AES-256) ✅
- Создание базовых классов Command и Response ✅
- Реализация механизма сериализации/десериализации сообщений ✅

## Этап 2: Серверная часть ✅
- Разработка фонового сервиса для Ubuntu ✅
- Имплементация обработчиков команд (shell, file, llm) ✅
- Создание системы логирования ✅
- Разработка механизма создания демона ✅
- Интеграция с systemd для автозапуска ✅

## Этап 3: Клиентская часть ✅
- Разработка клиентского API ✅
- Создание механизма подключения к серверу ✅
- Реализация интерфейса командной строки ✅
- Добавление поддержки различных типов команд ✅

## Этап 4: Безопасность и администрирование ✅
- Реализация шифрования на уровне сообщений ✅
- Добавление опциональной поддержки SSL ✅
- Создание инсталляционного скрипта ✅
- Разработка средств мониторинга и управления ✅

## Этап 5: Улучшения (В процессе)
- Реализация обмена ключами по алгоритму Диффи-Хеллмана ✅
  - Базовая реализация в key_exchange.py ✅
  - Интеграция с EnhancedSecureChannel ✅
  - Валидация ключей для защиты от MITM-атак ✅
  - Тестовый скрипт для проверки работы ✅
- Добавление аутентификации на основе сертификатов
- Создание плагина для популярных IDE
- Расширение API для поддержки новых типов команд
- Оптимизация производительности при передаче больших файлов

## Этап 6: Масштабирование (Запланировано)
- Поддержка кластера серверов
- Реализация механизма балансировки нагрузки
- Создание центрального сервера управления агентами
- Разработка панели администрирования
- Добавление метрик и аналитики использования

## Этап 7: Дополнительные функции (В процессе)
- Интеграция с существующими CI/CD системами
- Поддержка WebSocket для работы через веб-интерфейс
- Создание маркетплейса команд и сценариев
- Разработка системы плагинов для расширения функциональности
- Имплементация многопользовательского режима с разграничением прав
- Интеграция с LLM для автономного принятия решений ✅
  - Модуль NeuroRAT для работы с LLM ✅
  - Техники обхода AV из TheFatRat и Veil ✅
  - Автономное принятие решений на базе LLM ✅

## Этап 8: NeuroRAT - LLM-управляемый агент (Новый проект)
- Интеграция с локальными LLM (Ollama, llama.cpp) ✅
- Методы обхода антивирусной защиты ✅
- Автономное принятие решений на базе LLM ✅
- Модуль самоадаптации и обучения
- Динамическое изменение стратегии в зависимости от среды
- Многоуровневая персистентность
- Техники поиска целевых данных с помощью LLM
- Обфускация коммуникации и модификация протокола
- Создание распределенной сети агентов
- Внедрение техник обхода EDR/XDR решений
- Интеграция с моделью машинного обучения для обнаружения ценных данных

## Детальное поведение серверного агента

### 1. Инициализация (startup)
- Запуск как демон или сервис (systemd, init.d, nohup, supervisord)
- Проверка на уже запущенные экземпляры (через lock-файл или PID)
- Генерация уникального ID агента (если не был сгенерирован ранее)
- Загрузка конфигурации: ключи, параметры связи, ограничения
- Шифрованный handshake с сервером (ключ AES через обмен RSA или Diffie-Hellman)
- Самостоятельная "регистрация" на первом запуске

### 2. Основной цикл (loop)
- Регулярное соединение с сервером (или прием входящих при работе как listener)
- Отправка heartbeat/ping с ID, временем, версией, мета-информацией
- Прием зашифрованной команды
- Расшифровка, проверка целостности и валидности подписи
- Выполнение команды с использованием:
  - Подмодулей (exec, file, llm, monitor и др.)
  - Изоляции, если требуется (chroot, subprocess, jail)
- Сбор результата, шифрование, отправка серверу
- Поддержка разных уровней приоритета (срочные, фоновые, отложенные задачи)

### 3. Поведение при ошибках/отсутствии связи
- Переход в оффлайн-режим при отсутствии связи с сервером:
  - Запись команд в очередь
  - Периодические попытки переподключения
- Инициация повторного handshake при истечении/повреждении ключа шифрования
- Логирование критических ошибок и самоперезапуск
- Отправка уведомлений через альтернативные каналы (резервный адрес, webhook)

### 4. Поддерживаемые команды (payloads)
| Команда | Назначение |
|---------|------------|
| exec | Выполнить shell-команду |
| read_file | Прочитать содержимое файла |
| write_file | Записать/создать файл |
| list_dir | Просмотр содержимого директории |
| query_llm | Отправка запроса в локальный LLM |
| upload | Отправка файла серверу |
| download | Получение файла с сервера |
| sysinfo | Информация о CPU, RAM, uptime |
| ping | Проверка соединения |
| self_update | Обновление бинарника или модулей |
| self_destruct | Самоудаление агента |

### 5. Устойчивость (persistence)
- Регистрация как systemd-сервис с автостартом и перезапуском
- Самоконтроль: перезапуск при неактивности N минут
- Опциональная обфускация имени процесса
- Шифрование логов и файлов конфигурации

### 6. Безопасность
- AES-256 шифрование всех сообщений (GCM или CBC + HMAC)
- RSA-2048 для установки ключа при первом handshake
- Хеширование команд для проверки целостности
- Валидация токена/подписи сервера для недоверенных сетей
- Опциональный запрет команд от неизвестных IP

### 7. Особенности LLM-доступа
- Локальное обращение к LLM API (через localhost:11434 или unix socket)
- Передача текста от сервера в LLM и возврат ответа
- Кэширование результатов для снижения нагрузки

### 8. Поведение при обновлении
- Проверка наличия новой версии (по контрольной сумме или версии)
- Загрузка обновленного бинарника/скрипта
- Проверка цифровой подписи
- Самозамена (горячая замена или перезапуск)
- Сообщение серверу об успешном обновлении

### 9. Логирование и отладка
- Запись зашифрованных логов в ~/.agent/logs/agent.log
- Передача лога серверу по команде
- Поддержка уровней логирования: DEBUG/INFO/ERROR
- Отдельный лог по выполненным командам

### Дополнительно (на перспективу)
- Веб-интерфейс или TUI на сервере для мониторинга агентов
- Автогенерация токенов/ключей при развертывании
- Интеграция с Telegram/Discord для срочных уведомлений
- Кросс-платформенность (Linux, Mac, Windows)

## График релизов

| Версия | Дата      | Основные функции                                   |
|--------|-----------|---------------------------------------------------|
| 0.1.0  | Выполнено | Базовая коммуникация, шифрование                  |
| 0.2.0  | Выполнено | Полнофункциональный сервер и клиент               |
| 0.3.0  | Q3 2023   | Улучшенная безопасность, улучшения производительности |
| 0.4.0  | Q4 2023   | Плагины для IDE, расширенная функциональность     |
| 1.0.0  | Q1 2024   | Стабильный релиз с полной документацией           |
| 1.1.0  | Q2 2024   | Масштабирование и кластеризация                   |
| 2.0.0  | Q4 2024   | Полноценная экосистема с маркетплейсом            |

## Приоритеты развития

### Высокий приоритет
- Безопасность и шифрование
- Стабильность работы
- Расширение функциональности API

### Средний приоритет
- Интеграция с популярными IDE
- Документация и примеры использования
- Производительность при передаче больших объемов данных

### Низкий приоритет
- Графический интерфейс администрирования
- Маркетплейс расширений
- Нативные клиенты для мобильных устройств 